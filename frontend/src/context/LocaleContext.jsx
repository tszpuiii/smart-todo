import { createContext, useContext, useEffect, useMemo, useState } from 'react';

const LocaleContext = createContext(null);

const MESSAGES = {
  en: {
    header_today: 'Today',
    header_upcoming: 'Upcoming',
    header_expired: 'Expired',
    header_calendar: 'Calendar',
    header_board: 'Sticky Wall',
    header_tasks: 'Tasks',
    header_category: 'Category',
    header_status: 'Status',
    option_all: 'All',
    option_incomplete: 'Incomplete',
    option_complete: 'Complete',
    loading: 'Loading…',
    no_tasks: 'No tasks yet',
    select_date: 'Selected date',
    not_selected: 'Not selected',
    no_tasks_for_day: 'No tasks for this day',
    add_new_task: '+ Add New Task',
    no_lists_yet: 'No lists yet, please add',
    edit: 'Edit',
    delete: 'Delete',
    save: 'Save',
    cancel: 'Cancel',
    add_subtask: 'Add',
    subtask_placeholder: 'Add a subtask',
    subtasks: 'Subtasks',
    undo: 'Undo',
    complete: 'Complete',
    title: 'Title',
    due: 'Due',
    todo: 'To Do',
    doing: 'Doing',
    done: 'Done',
    add_new_page: '+ New page',
    new_page: 'New page',
    settings: 'Settings',
    theme: 'Theme',
    language: 'Language',
    day: 'Day',
    night: 'Night',
    english: 'English',
    traditional_chinese: '繁體中文',
    menu: 'Menu',
    search: 'Search',
    tasks_group: 'TASKS',
    lists_group: 'LISTS',
    apps_group: 'APPS',
    weather: 'Weather',
    settings_nav: 'Settings',
    sign_out: 'Sign out',
    add_new_list: '+ Add New List',
    home: 'Home',
    create: 'Create',
    accent: 'Accent',
    blue: 'blue',
    teal: 'teal',
    purple: 'purple',
    progress: 'Progress',
    recent: 'Recent',
    form_title: 'Title',
    form_title_ph: 'e.g. Buy milk',
    form_description: 'Description',
    form_description_ph: 'Optional',
    form_category: 'Category',
    form_status: 'Status',
    form_due: 'Due Date',
    form_notes: 'Notes',
    form_notes_ph: 'Additional notes (optional)',
    form_cancel: 'Cancel',
    form_create_saving: 'Creating…',
    form_create: 'Add Task',
    delete_list: 'Delete List',
    city_placeholder: 'City, Country',
    metric_c: 'Metric (°C)',
    imperial_f: 'Imperial (°F)',
    search_btn: 'Search',
    use_my_location: 'Use my location',
    hourly_forecast: 'Hourly forecast',
    eight_day_forecast: '8-day forecast',
    feels_like_label: 'Feels like',
    wind_label: 'Wind',
    humidity_label: 'Humidity',
    pressure_label: 'Pressure',
    geolocation_not_supported: 'Your browser does not support geolocation.',
    geolocation_failed: 'Failed to get your location. Please allow permission and try again.',
    city_lookup_failed: 'City lookup failed',
    empty_response: 'Empty response',
  },
  'zh-Hant': {
    header_today: '今天',
    header_upcoming: '即將到來',
    header_expired: '已逾期',
    header_calendar: '行事曆',
    header_board: '便利貼牆',
    header_tasks: '任務',
    header_category: '分類',
    header_status: '狀態',
    option_all: '全部',
    option_incomplete: '未完成',
    option_complete: '已完成',
    loading: '載入中…',
    no_tasks: '目前沒有任務',
    select_date: '選取日期',
    not_selected: '未選擇',
    no_tasks_for_day: '此日期沒有任務',
    add_new_task: '+ 新增任務',
    no_lists_yet: '尚無清單，請新增',
    edit: '編輯',
    delete: '刪除',
    save: '儲存',
    cancel: '取消',
    add_subtask: '加入',
    subtask_placeholder: '新增子任務',
    subtasks: '子任務',
    undo: '復原',
    complete: '完成',
    title: '標題',
    due: '到期',
    todo: '待辦',
    doing: '進行中',
    done: '已完成',
    add_new_page: '+ 新增頁面',
    new_page: '新頁面',
    settings: '設定',
    theme: '主題',
    language: '語言',
    day: '日間',
    night: '夜間',
    english: '英文',
    traditional_chinese: '繁體中文',
    menu: '選單',
    search: '搜尋',
    tasks_group: '任務',
    lists_group: '清單',
    apps_group: '應用',
    weather: '天氣',
    settings_nav: '設定',
    sign_out: '登出',
    add_new_list: '+ 新增清單',
    home: '首頁',
    create: '建立',
    accent: '重點色',
    blue: '藍色',
    teal: '青色',
    purple: '紫色',
    progress: '進度',
    recent: '最近更新',
    form_title: '標題',
    form_title_ph: '例如：買牛奶',
    form_description: '描述',
    form_description_ph: '可留空',
    form_category: '分類',
    form_status: '狀態',
    form_due: '到期日',
    form_notes: '備註',
    form_notes_ph: '可輸入額外說明',
    form_cancel: '取消',
    form_create_saving: '新增中…',
    form_create: '新增任務',
    delete_list: '刪除清單',
    city_placeholder: '城市, 國家',
    metric_c: '公制 (°C)',
    imperial_f: '英制 (°F)',
    search_btn: '搜尋',
    use_my_location: '使用我的位置',
    hourly_forecast: '每小時預報',
    eight_day_forecast: '8 日預報',
    feels_like_label: '體感',
    wind_label: '風速',
    humidity_label: '濕度',
    pressure_label: '氣壓',
    geolocation_not_supported: '您的瀏覽器不支援定位功能。',
    geolocation_failed: '無法取得您的位置，請允許權限後再試一次。',
    city_lookup_failed: '城市查詢失敗',
    empty_response: '無回應資料',
  },
};

export function LocaleProvider({ children }) {
  const [locale, setLocale] = useState(() => localStorage.getItem('locale') || 'en');
  useEffect(() => { localStorage.setItem('locale', locale); }, [locale]);

  const t = useMemo(() => {
    const dict = MESSAGES[locale] || MESSAGES.en;
    return (key) => dict[key] ?? key;
  }, [locale]);

  const value = useMemo(() => ({ locale, setLocale, t }), [locale, t]);
  return <LocaleContext.Provider value={value}>{children}</LocaleContext.Provider>;
}

export function useLocale() {
  const ctx = useContext(LocaleContext);
  if (!ctx) throw new Error('useLocale must be used within LocaleProvider');
  return ctx;
}


